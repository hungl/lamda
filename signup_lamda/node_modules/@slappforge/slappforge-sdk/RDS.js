/**
 * Copyright (c) 2017-2018 AdroitLogic Private Ltd. (https://www.adroitlogic.com). All Rights Reserved.
 * AdroitLogic PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
 */
let mysql = require('mysql');

module.exports = function (connectionManager) {

    this.connections = new connectionManager();

    this.query = function (params, callback, connection) {
        var connection = connection || mysql.createConnection(this.connections.dbConnections[params.instanceIdentifier]);
        var sqlQuery = params.query;
        var inserts = params.inserts || [];
        connection.query(mysql.format(sqlQuery, inserts), function (error, results) {
            callback(error, results, connection);
        });
    };

    this.beginTransaction = function (params, callback) {
        var connection = mysql.createConnection(this.connections.dbConnections[params.instanceIdentifier]);
        connection.beginTransaction(function (error) {
            callback(error, connection)
        });
    };
};